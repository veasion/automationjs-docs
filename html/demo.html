<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Demo 示例 | JS自动化测试 -1.0.0 文档</title>
  <link rel="stylesheet" href="assets/fonts.css">
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="assets/sh.css">
  <link rel="canonical" href="https://nodejs.org/api/demo.html">
</head>
<body class="alt apidoc" id="api-section-demo">
  <div id="content" class="clearfix">
    <div id="column2" class="interior">
      <div id="intro" class="interior">
        <a href="/" title="返回首页">
          JS自动化测试
        </a>
      </div>
      <ul>
<li><a class="nav-overview" href="overview.html">Overview - 综述</a></li>
<li><a class="nav-qa" href="qa.html">Q&amp;A - 常见问题</a></li>
<li><a class="nav-driver" href="driver.html">Driver - 基础函数</a></li>
<li><a class="nav-element" href="element.html">Element - 元素对象</a></li>
<li><a class="nav-element_ext" href="element_ext.html">ElementExt - 元素函数</a></li>
<li><a class="nav-env" href="env.html">Environment - 环境变量</a></li>
<li><a class="nav-jdbc" href="jdbc.html">Jdbc - 数据库</a></li>
<li><a class="nav-touch" href="touch.html">Touch - 鼠标操作</a></li>
<li><a class="nav-log" href="log.html">Logger - 日志</a></li>
<li><a class="nav-auto" href="auto.html">Auto - 模块及函数</a></li>
<li><a class="nav-demo active" href="demo.html">Demo - 示例</a></li>
</ul>

    </div>

    <div id="column1" data-id="demo" class="interior">
      <header>
        <h1>JS自动化测试 -1.0.0 文档</h1>
        <div id="gtoc">
          <p>
            <a href="index.html" name="toc">索引</a> |
            <a href="all.html">查看全部</a>
          </p>
        </div>
        <hr>
      </header>

      <div id="toc">
        <h2>目录</h2>
        <ul>
<li><span class="stability_undefined"><a href="#demo_demo">Demo 示例</a></span><ul>
<li><span class="stability_undefined"><a href="#demo">百度搜索 “中国”，进入百度百科结果</a></span></li>
<li><span class="stability_undefined"><a href="#demo_1">起点小说网搜索并下载斗破苍穹</a></span></li>
</ul>
</li>
</ul>

      </div>

      <div id="apicontent">
        <h1>Demo 示例<span><a class="mark" href="#demo_demo" id="demo_demo">#</a></span></h1>
<h2>百度搜索 “中国”，进入百度百科结果<span><a class="mark" href="#demo" id="demo">#</a></span></h2>
<pre><code class="lang-js">// demo 演示 中国百度百科
// @author luozhuowei

// 百度 &quot;中国&quot;
baiduSearch(&#39;中国&#39;);
// 获取搜索结果
let list = findDisplayed(&#39;css=div#content_left &gt; div&#39;);
// 变量搜索结果
for (let i in list) {
    let element = list[i].findOne(&quot;css=h3 &gt; a&quot;);
    // 判断结果是否为百度百科
    if (element &amp;&amp; element.text().endsWith(&quot;百度百科&quot;)) {
        // 点击
        element.click();
        // 等待页面加载
        waitForPageLoaded(10);
        // 切换到新打开的窗口
        switchToNextWindow();
        break;
    }
}

function baiduSearch(str) {
    open(&quot;https://www.baidu.com&quot;);
    sendKeys(&#39;id=kw&#39;, str);
    click(&quot;css=input[value=&#39;百度一下&#39;]&quot;);
    waitForPageLoaded(5);
}
</code></pre>
<h2>起点小说网搜索并下载斗破苍穹<span><a class="mark" href="#demo_1" id="demo_1">#</a></span></h2>
<pre><code class="lang-js">// demo 演示 爬小说
// @author luozhuowei

let bookName = &#39;斗破苍穹&#39;;
// 爬取前5章
let chapterCount = 5;
// 保存到桌面
let savePath = env.getString(&#39;DESKTOP_DIR&#39;) + &#39;\\斗破苍穹.txt&#39;;

log.info(&#39;正在下载: &#39; + bookName);
log.info(&#39;保存路径: &#39; + savePath);

// 起点小说
open(&#39;https://www.qidian.com&#39;);
// 搜索
sendKeys(&#39;id=s-box&#39;, bookName);
tryClick(&#39;id=search-btn&#39;);
switchToNextWindow();
waitForPageLoaded();
sleep(500);

// 点击搜索结果
findOne(&#39;css=#result-list&#39;).findOne(&#39;linkText=&#39; + bookName).tryClick();
switchToNextWindow();
waitForPageLoaded();

// 点击“免费试读”
findText(&#39;a&#39;, &#39;免费试读&#39;, false).tryClick();
waitForPageLoaded();

// 关闭广告弹窗
tryClick(&#39;css=a.lbf-panel-close&#39;);
sleep(200);

for (let i = 0; i &lt; chapterCount; i++) {
    // 小说主体
    let bookBody = findOne(&#39;css=#j_chapterBox div.main-text-wrap&#39;);
    // 移除评论
    executeScript(&quot;document.querySelectorAll(&#39;span.review-count&#39;).forEach(item =&gt; item.remove());&quot;);
    // 小说标题
    let title = bookBody.findOne(&#39;css=.j_chapterName&#39;).text();
    log.info(title);
    // 小说内容
    let context = bookBody.findOne(&#39;css=div.read-content.j_readContent&#39;).text().replace(/[\n]/g, &#39;\r\n\r\n&#39;);
    // 保存小说
    writeText(savePath, title + &#39;\r\n\r\n&#39; + context + &#39;\r\n\r\n\r\n\r\n&#39;, true);
    // 下一章
    let nextPage = findOne(&#39;id=j_chapterNext&#39;);
    if (nextPage) {
        nextPage.tryClick();
        waitForPageLoaded();
        sleep(200);
    } else {
        break;
    }
}
</code></pre>

      </div>
    </div>
  </div>
  <script src="assets/sh_main.js"></script>
  <script src="assets/sh_javascript.min.js"></script>
  <script>highlight(undefined, undefined, 'pre');</script>
  <!-- __TRACKING__ -->
</body>
</html>